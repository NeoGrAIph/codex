# Multi-agent notes

> Owner: <team/owner> | Scope: fork/colab-agents | Audience: devs
> Status: active | Last reviewed: 2026-02-04 | Related: docs/fork/colab-agents.md

## Категории и критерии выбора

Выбирай категорию по доминирующему аспекту проблемы:

- **Bug** — функциональность ведёт себя не так, как описано в спецификации или ожиданиях пользователя (например, регрессия, некорректный ответ API).
- **Incident** — проблема уже затронула prod/stage и требует расследования последствий (простой сервиса, деградация SLA, аварийная операция).
- **Security** — обнаружено нарушение политики безопасности или уязвимость, которую может использовать злоумышленник (отсутствие аутентификации, утечка данных, риск эскалации привилегий).
- **Performance** — система не удовлетворяет требованиям по времени ответа, пропускной способности или ресурсопотреблению (рост задержек, узкое место в ресурсах, неэффективные алгоритмы).
- **Reliability** — поведение компонента нестабильно или приводит к сбоям/неопределённым состояниям без явного нарушения функциональности (тесты, редкие сбои, сложность восстановления).
- **Documentation** — недостаточно информации в руководствах или спецификациях, мешающее эксплуатации или разработке (устаревшие инструкции, отсутствие схем).
- **Process/DX** — неэффективность в инструментах разработки, CI/CD, рабочих процессах команды (долгие сборки, несогласованные процедуры).
- **Enhancement** — улучшение существующего поведения или добавление нового функционала без критичной необходимости (фич-запросы, UX-полировки).

Если ситуация попадает сразу в несколько категорий, выбери основную по наиболее критичному аспекту и перечисли дополнительные в поле «Теги».

## Уровни важности

- **Critical** — требуется немедленное реагирование; риск серьёзных последствий или нарушение регуляторных/контрактных обязательств.
- **High** — существенно влияет на функциональность или пользователей, но допускает короткую задержку перед устранением.
- **Medium** — влияние ограничено, существуют обходные пути или воздействие минимально.
- **Low** — низкий риск и влияние; может быть запланировано на будущее окно или совмещено с другими задачами.

## Шаблон записи

`Проблемы и риски`/`Улучшения`

```md
### <Краткое имя задачи>
- **Категория:** <выбери из списка выше>
- **Важность:** <Critical | High | Medium | Low>
- **Обнаружено:** <дата>
- **Контекст:** <где замечено: сервис/окружение/версия>
- **Описание:**
  - *Фактическое поведение:* <что происходит сейчас>
  - *Ожидаемое поведение:* <как должно работать>
- **Шаги воспроизведения:**
  1. <минимально достаточные шаги>
  2. <...>
- **Последствия/риск:** <какого масштаба влияние, кого затронуло>
- **Предложенное решение:** <гипотеза исправления или направления анализа>
- **Связанные материалы:** <ссылки на тикеты, PR, ADR, документацию>
- **Теги:** <ключевые слова через запятую для поиска и аналитики>
- **Статус:** <Open | In Progress | Blocked | Resolved> (при закрытии указать ссылку на фиксацию)
```

## Проблемы и риски

### Spawned Explorer Lacks Repo Read Tools
- **Категория:** Process/DX
- **Важность:** High
- **Обнаружено:** 2026-02-04
- **Контекст:** `spawn_agent` → `agent_type=explorer` (локальная сессия Codex CLI)
- **Описание:**
  - *Фактическое поведение:* заспавненный `explorer` сообщает, что не имеет доступа к ФС/инструментам чтения и не может ориентироваться в репозитории.
  - *Ожидаемое поведение:* `explorer` должен иметь read-only инструменты (`read_file`, `list_dir`, `grep_files`) и уметь выдавать точные “файл → что там”.
- **Шаги воспроизведения:**
  1. Вызвать `spawn_agent` с `agent_type=explorer` и задачей “найди в коде X”.
  2. Получить ответ, что доступов/инструментов нет.
- **Последствия/риск:** multi-agent распараллеливание “ломается” на базовом сценарии (поиск/навигация), теряем основную выгоду от `explorer`.
- **Предложенное решение:** выяснить реальную причину “tool-less explorer” и сделать поведение детерминированным.
  Текущая гипотеза (подтверждать кодом): `read_file/list_dir/grep_files` регистрируются только если модель объявляет их в `experimental_supported_tools` (`codex-rs/core/src/tools/spec.rs`), а для `gpt-5.2-codex` в offline `ModelInfo` список пустой (`codex-rs/core/src/models_manager/model_info.rs`). В результате `explorer` получает allowlist на несуществующие в registry tools → остаётся без инструментов.
  Направления исправления:
  1) Добавить фолбэк‑инструмент, который реально доступен для базовой модели (`shell_command`), чтобы `explorer` не становился tool-less даже при отсутствии `read_file/list_dir/grep_files`.
  2) Опционально (отдельным решением): расширить `experimental_supported_tools` для `gpt-5.2-codex`, если хотим продвигать специализированные read-only file tools.
- **Связанные материалы:** `docs/fork/colab-agents.md`
- **Теги:** spawn_agent, explorer, tools, dx, registry, allowlist
- **Статус:** Resolved (fallback + расширение `experimental_supported_tools` для `gpt-5.2-codex`)

## Улучшения
