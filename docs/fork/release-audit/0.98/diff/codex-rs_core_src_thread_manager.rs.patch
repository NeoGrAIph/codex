diff --git a/codex-rs/core/src/thread_manager.rs b/codex-rs/core/src/thread_manager.rs
index e702d9a00..23677392f 100644
--- a/codex-rs/core/src/thread_manager.rs
+++ b/codex-rs/core/src/thread_manager.rs
@@ -29,6 +29,7 @@ use codex_protocol::protocol::Op;
 use codex_protocol::protocol::RolloutItem;
 use codex_protocol::protocol::SessionSource;
 use std::collections::HashMap;
+use std::collections::HashSet;
 use std::path::PathBuf;
 use std::sync::Arc;
 #[cfg(any(test, feature = "test-support"))]
@@ -110,6 +111,7 @@ pub(crate) struct ThreadManagerState {
     skills_manager: Arc<SkillsManager>,
     file_watcher: Arc<FileWatcher>,
     session_source: SessionSource,
+    spawn_children: Arc<RwLock<HashMap<ThreadId, HashSet<ThreadId>>>>,
     #[cfg(any(test, feature = "test-support"))]
     #[allow(dead_code)]
     // Captures submitted ops for testing purpose.
@@ -134,6 +136,7 @@ impl ThreadManager {
                 file_watcher,
                 auth_manager,
                 session_source,
+                spawn_children: Arc::new(RwLock::new(HashMap::new())),
                 #[cfg(any(test, feature = "test-support"))]
                 ops_log: Arc::new(std::sync::Mutex::new(Vec::new())),
             }),
@@ -178,6 +181,7 @@ impl ThreadManager {
                 file_watcher,
                 auth_manager,
                 session_source: SessionSource::Exec,
+                spawn_children: Arc::new(RwLock::new(HashMap::new())),
                 #[cfg(any(test, feature = "test-support"))]
                 ops_log: Arc::new(std::sync::Mutex::new(Vec::new())),
             }),
@@ -373,6 +377,26 @@ impl ThreadManagerState {
         thread.submit(op).await
     }
 
+    pub(crate) async fn register_spawn_child(&self, parent: ThreadId, child: ThreadId) {
+        let mut map = self.spawn_children.write().await;
+        map.entry(parent).or_default().insert(child);
+    }
+
+    pub(crate) async fn children_of(&self, parent: ThreadId) -> Vec<ThreadId> {
+        let map = self.spawn_children.read().await;
+        map.get(&parent)
+            .map(|children| children.iter().cloned().collect())
+            .unwrap_or_default()
+    }
+
+    pub(crate) async fn drop_thread_links(&self, thread_id: ThreadId) {
+        let mut map = self.spawn_children.write().await;
+        map.remove(&thread_id);
+        for children in map.values_mut() {
+            children.remove(&thread_id);
+        }
+    }
+
     /// Remove a thread from the manager by ID, returning it when present.
     pub(crate) async fn remove_thread(&self, thread_id: &ThreadId) -> Option<Arc<CodexThread>> {
         self.threads.write().await.remove(thread_id)
