# Задача: план доработок fork/colab-agents

> Owner: <team/owner> | Scope: fork/colab-agents | Audience: devs
> Status: active | Last reviewed: 2026-02-04 | Related: docs/fork/diff-fork-vs-main.md, docs/fork/colab-agents.md

## Контекст

По результатам анализа diff между `fork/colab-agents` и `main` (v0.95.0)
зафиксированы ключевые расхождения и зоны риска. Нужен отдельный план
доработок/изменений форка, чтобы:

- сохранить fork‑ценность (multi‑agents + реестр);
- минимизировать дрейф относительно upstream;
- сделать интеграции повторяемыми и безопасными.

## Цель

Сформировать **план доработок** `fork/colab-agents` на основе результатов исследования,
с чёткими этапами, приоритетами, критериями готовности и рисками.

## Done criteria

- Создан документ плана доработок (в `docs/fork/`), включающий:
  - цели, объём работ и ограничения;
  - список fork‑ядра (что сохраняем всегда);
  - план синхронизации с upstream по зонам;
  - правила работы со схемами/fixtures;
  - тестовый минимум;
  - риски и стратегии их минимизации.
- План ссылается на `docs/fork/diff-fork-vs-main.md` и `docs/fork/colab-agents.md`.

## Scope

Включить в план:
- `codex-rs/core` (agent registry, collab, allow/deny)
- `codex-rs/tui` (fork‑брендинг)
- `app-server-protocol` (генерация схем)
- процесс commit‑by‑commit интеграции

Не включать:
- новые функциональные фичи, не связанные с синхронизацией/сохранением fork‑ценности
- изменения, не подтверждённые diff‑анализом

## Входные данные

- `docs/fork/diff-fork-vs-main.md`
- `docs/fork/colab-agents.md`
- `docs/fork/upstream-main-commits.md`

## Шаги выполнения

1) Зафиксировать базу синхронизации (main v0.95.0) и fork‑ядро.
2) Описать принципы каноничности: upstream‑first, fork‑слой минимален.
3) Разделить изменения на зоны: core / tui / protocol / docs.
4) Для каждой зоны определить:
   - что оставляем как fork‑ценность;
   - что подтягиваем целиком из upstream;
   - какие правила генерации/схем обязательны.
5) Зафиксировать минимальный тестовый контур.
6) Записать риски (конфликты, дрейф версии, схемы) и меры снижения.

## Риски

- Дрейф версии (если fork уйдёт от базового релиза).
- Ручные правки в схемах/fixtures.
- Конфликты в `core`/`tui`.

## Выходные артефакты

- Новый документ плана доработок в `docs/fork/`.
